name: Auto Green 2023 (Correct Layout)

on:
  push:
    branches:
      - master
  schedule:
    - cron: "0 0 * * *"  # 每天执行

jobs:
  autogreen:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整提交历史

      - name: Auto green to show 2023
        run: |
          set -e
          git config --local user.email "${{ secrets.EMAIL }}"
          git config --local user.name "${{ secrets.NAME }}"
          git remote set-url origin https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git pull --rebase
          
          start_date="2023-01-01"  # 2023年第一个星期日
          offsets_2023=(
            # 数字2（周25-31，日-四）
            175 176 177 178 179  # 周25
            182 183 184 185 186  # 周26
            189 190 191 192 193  # 周27
            196 197 198 199 200  # 周28
            203 204 205 206 207  # 周29
            210 211 212 213 214  # 周30
            217 218 219 220 221  # 周31
            
            # 数字0（周32-38，日-四）
            224 225 226 227 228  # 周32
            231 232 233 234 235  # 周33
            238 239 240 241 242  # 周34
            245 246 247 248 249  # 周35
            252 253 254 255 256  # 周36
            259 260 261 262 263  # 周37
            266 267 268 269 270  # 周38
            
            # 数字2（周39-45，日-四）
            273 274 275 276 277  # 周39
            280 281 282 283 284  # 周40
            287 288 289 290 291  # 周41
            294 295 296 297 298  # 周42
            301 302 303 304 305  # 周43
            308 309 310 311 312  # 周44
            315 316 317 318 319  # 周45
            
            # 数字3（周46-52，日-四）
            322 323 324 325 326  # 周46
            329 330 331 332 333  # 周47
            336 337 338 339 340  # 周48
            343 344 345 346 347  # 周49
            350 351 352 353 354  # 周50
            357 358 359 360 361  # 周51
            364 365 366 367 368  # 周52
          )
          
          light_green_commits=1     # 背景区域提交次数（浅色）
          full_green_commits=5      # 数字区域提交次数（深色）
          total_days=365            # 2023年非闰年共365天
          
          for (( day = 0; day < total_days; day++ )); do
            commit_date=$(date -d "$start_date + $day days" +'%Y-%m-%d %H:%M:%S')
            
            if printf '%s\n' "${offsets_2023[@]}" | grep -qx "$day"; then
              for (( i = 0; i < full_green_commits; i++ )); do
                GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Dark green at $commit_date" --date "$commit_date"
              done
            else
              for (( i = 0; i < light_green_commits; i++ )); do
                GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Light green at $commit_date" --date "$commit_date"
              done
            fi
          done
          
          git push
