name: GitHub Heatmap - I LOVE YOU

on:
  workflow_dispatch:  # 允许手动触发
  push:
    branches:
      - master
  schedule:
    - cron: "0 0 * * 0"  # 每周日运行一次

jobs:
  heatmap:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v3

      - name: Generate "I LOVE YOU" pattern on heatmap
        run: |
          set -e
          git config --local user.email "wangyuan0999@gmail.com"
          git config --local user.name "Biang0"
          git remote set-url origin https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git pull --rebase

          # 2023年1月1日是星期日
          start_date="2023-01-01"

          # "I LOVE YOU" 点阵 (7x53)
          pattern=(
            "0000001000000000000000000000000000000000000000000000000000000"
            "0000001000000000100000001000000000010000001000010000010000000"
            "0000001000000000100000001000000000010000001000010000010000000"
            "0000001000000000111100001000000000010000001000010000010000000"
            "0000001000000000100000001000000000010000001000010000010000000"
            "0000001000000000100000001000000000010000001000010000010000000"
            "0000001000000000000000000000000000000000000000000000000000000"
          )

          # 生成提交
          for week in {0..52}; do
            for day in {0..6}; do
              if [ "${pattern[$day]:$week:1}" == "1" ]; then
                commit_date=$(date -d "$start_date +$((week * 7 + day)) days" +"%Y-%m-%d %H:%M:%S")
                echo "Committing 5 times on $commit_date"
                for i in {1..5}; do  # 每个绿色点提交 5 次
                  GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Draw I LOVE YOU at $commit_date (commit $i)" --date "$commit_date"
                done
              fi
            done
          done

          git push