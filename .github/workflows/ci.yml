name: Auto Green 2020 (Dark 50 commits)

on:
  push:
    branches:
      - master
  schedule:
    - cron: "0 0 * * *"  # 每天执行

jobs:
  autogreen:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整提交历史

      - name: Auto green to show 2020
        run: |
          set -e
          git config --local user.email "${{ secrets.EMAIL }}"
          git config --local user.name "${{ secrets.NAME }}"
          git remote set-url origin https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git pull --rebase
          
          start_date="2020-01-05"  # 2020年第一个星期日
          offsets_2020=(
            # 数字2（左）
            175 176 177 178 179 182 183 184 185 189 196 203 206 207 208 209 213 214 215 216 220 227 234 237 238 239 240 244 245 246 247
            
            # 数字0（中左）
            179 180 181 182 186 187 188 189 193 200 207 214 217 218 219 220 224 225 226 227 196 203 210 217
            
            # 数字2（中右）
            235 236 237 238 242 243 244 245 249 256 263 266 267 268 269 273 274 275 276 280 287 294 297 298 299 300 304 305 306 307
            
            # 数字0（右）
            239 240 241 242 246 247 248 249 253 260 267 274 277 278 279 280 284 285 286 287 256 263 270 277
          )
          
          light_green_commits=1      # 背景区域提交次数（浅色）
          full_green_commits=50      # 数字区域提交次数（深色） → 改为50
          total_days=366             # 2020年闰年共366天
          
          for (( day = 0; day < total_days; day++ )); do
            commit_date=$(date -d "$start_date + $day days" +'%Y-%m-%d %H:%M:%S')
            
            if printf '%s\n' "${offsets_2020[@]}" | grep -qx "$day"; then
              for (( i = 0; i < full_green_commits; i++ )); do
                GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Dark green at $commit_date" --date "$commit_date"
              done
            else
              for (( i = 0; i < light_green_commits; i++ )); do
                GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Light green at $commit_date" --date "$commit_date"
              done
            fi
          done
          
          git push
