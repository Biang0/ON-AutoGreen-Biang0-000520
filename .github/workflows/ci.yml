name: GitHub Heatmap - 2020 (Year)

on:
  workflow_dispatch:  # 允许手动触发

jobs:
  heatmap:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v3

      - name: Generate "2020" pattern on 2020 heatmap
        run: |
          set -e
          git config --local user.email "wangyuan0999@gmail.com"
          git config --local user.name "Biang0"
          git remote set-url origin https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git pull --rebase

          # 2020年1月1日是星期三，所以要适配 GitHub 的周日对齐
          start_date="2019-12-29"  # 让2020年的热力图从正确的周日开始

          # "2020" 点阵 (7x53)，1表示有提交
          pattern=(
            "01110001111000111100000000000000000000000000000000000000000000000"
            "01001001001001000010000000000000000000000000000000000000000000000"
            "01000001000001000010000000000000000000000000000000000000000000000"
            "01000001110001000010000000000000000000000000000000000000000000000"
            "01000000001001000010000000000000000000000000000000000000000000000"
            "01001001001001000010000000000000000000000000000000000000000000000"
            "01110001111000111100000000000000000000000000000000000000000000000"
          )

          # 生成提交
          for week in {0..52}; do
            for day in {0..6}; do
              if [ "${pattern[$day]:$week:1}" == "1" ]; then
                commit_date=$(date -d "$start_date +$((week * 7 + day)) days" +"%Y-%m-%d %H:%M:%S")
                echo "Committing 5 times on $commit_date"
                for i in {1..5}; do  # 每个绿色点提交 5 次
                  GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Draw 2020 at $commit_date (commit $i)" --date "$commit_date"
                done
              fi
            done
          done

          git push