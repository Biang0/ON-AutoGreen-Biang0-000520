name: Auto Green 2023 (50 Commits Dark)

on:
  push:
    branches:
      - master
  schedule:
    - cron: "0 0 * * *"  # 每天执行

jobs:
  autogreen:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整提交历史

      - name: Auto green to show 2023
        run: |
          set -e
          git config --local user.email "${{ secrets.EMAIL }}"
          git config --local user.name "${{ secrets.NAME }}"
          git remote set-url origin https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git pull --rebase
          
          start_date="2023-01-01"  # 2023年第一个星期日
          offsets_2023=(
            # 数字2（左）
            175 176 177 178 179 182 183 184 185 189 196 203 206 207 208 209 213 214 215 216 220 227 234 237 238 239 240 244 245 246 247
            
            # 数字0（中左）
            201 202 203 204 208 209 210 211 215 222 229 232 233 234 235 239 240 241 242 243 227 234 241 248
            
            # 数字2（中右）
            267 268 269 270 274 275 276 277 281 288 295 298 299 300 301 305 306 307 308 312 319 326 329 330 331 332 336 337 338 339
            
            # 数字3（右）
            303 304 305 306 310 311 312 313 317 324 331 338 341 342 343 344 348 349 350 351 329 336 343 350
          )
          
          light_green_commits=0     # 浅色区域不提交
          full_green_commits=50     # 深色区域每天提交50次
          total_days=365            # 2023年非闰年共365天
          
          for (( day = 0; day < total_days; day++ )); do
            commit_date=$(date -d "$start_date + $day days" +'%Y-%m-%d %H:%M:%S')
            
            if printf '%s\n' "${offsets_2023[@]}" | grep -qx "$day"; then
              for (( i = 0; i < full_green_commits; i++ )); do
                GIT_COMMITTER_DATE="$commit_date" git commit --allow-empty -m "Dark green at $commit_date" --date "$commit_date"
              done
            else
              # 浅色区域不提交
              :
            fi
          done
          
          git push
